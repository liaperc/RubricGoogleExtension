(function(){const t=document.createElement("link").relList;if(t&&t.supports&&t.supports("modulepreload"))return;for(const e of document.querySelectorAll('link[rel="modulepreload"]'))d(e);new MutationObserver(e=>{for(const n of e)if(n.type==="childList")for(const a of n.addedNodes)a.tagName==="LINK"&&a.rel==="modulepreload"&&d(a)}).observe(document,{childList:!0,subtree:!0});function r(e){const n={};return e.integrity&&(n.integrity=e.integrity),e.referrerPolicy&&(n.referrerPolicy=e.referrerPolicy),e.crossOrigin==="use-credentials"?n.credentials="include":e.crossOrigin==="anonymous"?n.credentials="omit":n.credentials="same-origin",n}function d(e){if(e.ep)return;e.ep=!0;const n=r(e);fetch(e.href,n)}})();console.log("Popup script loaded!");async function s(){const o=document.getElementById("downloadPdfs"),t=document.getElementById("status");try{const[r]=await chrome.tabs.query({active:!0,currentWindow:!0});if(!r.url||!r.url.includes("docs.google.com/spreadsheets"))return o.disabled=!0,t.textContent="Please open a Google Sheets tab",!1;const d=await chrome.runtime.sendMessage({type:"checkDownloadStatus"});return d&&d.isDownloading?(o.disabled=!0,o.textContent="Downloading...",t.textContent="Download in progress...",!1):(o.disabled=!1,o.textContent="Download Sheet PDFs",t.textContent="Ready to download PDFs",!0)}catch(r){return console.error("Error checking tab:",r),o.disabled=!0,t.textContent="Error checking tab",!1}}async function c(){const o=document.getElementById("downloadPdfs"),t=document.getElementById("status");try{o.disabled=!0,o.textContent="Downloading...",t.textContent="Starting download...";const[r]=await chrome.tabs.query({active:!0,currentWindow:!0}),d=r.url.match(/\/d\/([a-zA-Z0-9-_]+)/)?.[1];if(!d){t.textContent="Error: Could not find spreadsheet ID",o.textContent="Download Sheet PDFs",await s();return}t.textContent="Fetching sheet data...",chrome.runtime.sendMessage({type:"downloadSheetPdfs",spreadsheetId:d,tabId:r.id},async e=>{if(e&&e.success){const n=e.failed>0?` (${e.failed} failed)`:"";t.textContent=`Success! Downloaded ${e.count} PDFs${n}`,o.textContent="Download Sheet PDFs"}else t.textContent=`Error: ${e?.error||"Unknown error"}`,o.textContent="Download Sheet PDFs";await s()})}catch(r){console.error("Error in downloadPdfs:",r),t.textContent=`Error: ${r.message}`,o.textContent="Download Sheet PDFs",await s()}}document.addEventListener("DOMContentLoaded",s);chrome.tabs.onActivated.addListener(s);chrome.tabs.onUpdated.addListener(s);document.getElementById("downloadPdfs").addEventListener("click",c);
